from BaseHTTPServer import BaseHTTPRequestHandler,HTTPServer
from urlparse import parse_qs

import os
import os.path
import sys
import ssl
import cgi
import certifi
import tempfile
import requests

hostfile = "C:\Windows\System32\Drivers\etc\hosts"
cafile = certifi.where()
serverip = "127.69.69.69"
temppath = tempfile.gettempdir()
certpath = temppath+"/cert.pem"
keypath = temppath+"/key.pem"

CA_CERT = """
# Issuer: @BDKR28
-----BEGIN CERTIFICATE-----
MIID5zCCAs+gAwIBAgIUTC4E3D8/77GYnw5xEcFqrxd8TPkwDQYJKoZIhvcNAQEL
BQAwgYIxCzAJBgNVBAYTAlVLMQ8wDQYDVQQIDAZMb25kb24xDzANBgNVBAcMBkxv
bmRvbjEQMA4GA1UECgwHTlVMTCBDTzELMAkGA1UECwwCZHYxEjAQBgNVBAMMCXlv
dWZveC5jbzEeMBwGCSqGSIb3DQEJARYPYWRtaW5AeW91Zm94LmNvMB4XDTIyMDQy
NDE3MDUwN1oXDTMyMDQyMTE3MDUwN1owgYIxCzAJBgNVBAYTAlVLMQ8wDQYDVQQI
DAZMb25kb24xDzANBgNVBAcMBkxvbmRvbjEQMA4GA1UECgwHTlVMTCBDTzELMAkG
A1UECwwCZHYxEjAQBgNVBAMMCXlvdWZveC5jbzEeMBwGCSqGSIb3DQEJARYPYWRt
aW5AeW91Zm94LmNvMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAptcU
1vzE4J2YrCufP0yX5oW9r17qyjmN2lZh0ACaZFwYxf4W3boUh2bcOMK1/aiKSMIC
18ckexog/8/UR/0KxMBNBC2VCSu8XCRv31Bhu1PuzPKGeJePa+QIPYtCvjuaHWsu
dN27k58k7WwnjcvRQWvSo9+1yuzop2S4FGWkFdneAy2+/TR+6yL6WuT8Jlomh8F5
OEwB1VwfJNeTOrCYzqe7hgDDUD8GLH6GH9qOirhNSrmWr3Qq+xN502xabx00kqQm
HW3rOvdLGo8riLtM74P1JMIEGGjF4sIuMVfgSVSrn2F/1lvvG7OQ8MgIyMZMF1jh
m1hqfk5LdNOC2uWa/wIDAQABo1MwUTAdBgNVHQ4EFgQUVBmnvoFUnPqgDuYKA7wV
XMKMXCgwHwYDVR0jBBgwFoAUVBmnvoFUnPqgDuYKA7wVXMKMXCgwDwYDVR0TAQH/
BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAXLGxmgfoTBLbtb8gcxbeoKTp5kbk
prhzvLF6xzYt450xuhEpoMOSfqNQ2+37OOT+NCL69AN3cpfixRrtHDYgwAOhWjrz
lk9vUxrtlEa4QUNgecvTvs2ZLdhKVRPqVrGJo1xJrVmcQavKgm5rkshRr8ncQt7+
DmErkKVOgACJwJIRoiIjIewNGtrZiKHvulC0dJ6lxaTaSa7lAVSxmJjB2L+thMq3
jWMxcPJY8JGkfsH45TbIxlVzaxDM9wBst6LYOb5+FMG8dsYcm1/uQRNLm9zs9NXo
wxE1FYZPW+GlPObSr1QtBr5YkF52pQuQrnM21LdudCxmP6iw9aY1EiRDDQ==
-----END CERTIFICATE-----

"""

CA_KEY = """
-----BEGIN PRIVATE KEY-----
MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCm1xTW/MTgnZis
K58/TJfmhb2vXurKOY3aVmHQAJpkXBjF/hbduhSHZtw4wrX9qIpIwgLXxyR7GiD/
z9RH/QrEwE0ELZUJK7xcJG/fUGG7U+7M8oZ4l49r5Ag9i0K+O5oday503buTnyTt
bCeNy9FBa9Kj37XK7OinZLgUZaQV2d4DLb79NH7rIvpa5PwmWiaHwXk4TAHVXB8k
15M6sJjOp7uGAMNQPwYsfoYf2o6KuE1KuZavdCr7E3nTbFpvHTSSpCYdbes690sa
jyuIu0zvg/UkwgQYaMXiwi4xV+BJVKufYX/WW+8bs5DwyAjIxkwXWOGbWGp+Tkt0
04La5Zr/AgMBAAECggEAQxcmiDVpLjHxnPqFtTylsMuDNaxjmiJ+ypgGCVDUxRrL
04KTy2Hys2hHkoOqD3Dg+tUZs4+fOemN75Cxeqlk1S3HSrDRx7hQrHTyj8iRJHVi
CARW0tOPlwFB1w3TLxBkrwPU0KYBsiFDBj6BwWF+qmIjeEaToiCWhgnYhEtDKo2l
lBQBSuNh+Q9W3b1PpnW0Q2rFNpZQWD37aiTFFlQaheYMj8YD6b6ovGaUXkxu9zZw
1bXxyysd4+/0d9l6YE3NDYjlXieX/Je2xxJKnJ4dmQcsiLISVr/GiX1+CP+Gub+h
+BPPjR+td4d/BYx2Dwe/N++eLYjkgEmSsgHkjvoHYQKBgQDUicLAksLgfual2YZJ
DjPKw35FJcGG7Z3fD0ufVScJrpMi2ddvb6cjgFl3COg68oDC8JziNLwrbP87v+G6
YfhtCCQNf9tm0aIqLrkrVVunjVCVLdGXxBTo2NK2Lw8uP+rqH/aKHOvN8cRaOwRo
sy3M8IlSq/Fy9HdOJvefXMvkiQKBgQDI9Q95wRDXNLe8c/aIoJ3t8yurlDndefkU
vVLDyGJTe2KxDl0CNIkEvQ23/H9hI6L0y58DEspn0E9Wf7xC0cpAkCx9VqHTMHhl
an6oEUBYhCIvflhQHL5apYhF4WWgSWyYVUL7J7K94EY5tg+Dm7AtP0MiFuhu8xlO
cEx3mgMxRwKBgBALEhNdQK6XhauRPuy20LwGg7qOfgxEVX1n9ypg0CCP9/VSgkuc
Hv60CozMtFL2yTdt2DnPB0Ez6hRFiLF8AbehPK90LkiVnGsYucuGlvOP3DxWiBKv
r3BgJY+w/7FbC81+eiq0wiv6ivrQp6WLmPJ2WbdO2Vv3DiZtFJYH+DAZAoGANp7N
LwW34xaUHifSyX4Gjwd6Ri+KrtUZS3bOCSLs/s3ZnFBQHWpUF7KfCPQbVzbNcwXp
WXeBBkiLV/JuJCdLdtL5FLQ4VeOlxcL1XA8cUzLO6+PGczfs0UyOxpel/LQYTStX
glZe8dcEn2kJvHbToujAAYMCeC2hIj3JuvRki78CgYBkDu1sLK8dBO7lcS+AgU2G
hlFqV7Uuq/6035LmqzxlIj8zR9crDcgGjln6DM/hrsh1Z/jj2k2manXn6A+oQ5F4
t6bkDFgNrSqvMEDMpb9ERJWjjU5icbrOzUu/72Fjj2ZlwLumW0gDv45x3HjJlmqI
cbus1Owg+M/qVX3V6wL3tg==
-----END PRIVATE KEY-----

"""

banner = """
___________             __   ___________           
\_   _____/_ __   ____ |  | _\_   _____/______  ___
 |    __)|  |  \_/ ___\|  |/ /|    __)/  _ \  \/  /
 |     \ |  |  /\  \___|    < |     \(  <_> >    < 
 \___  / |____/  \___  >__|_ \\\\___  / \____/__/\_ \\
     \/              \/     \/    \/             \/
   Fox ExV2 and RSF  Cracker v1.0 | @Mr. BDKR28 |
"""
class myHandler(BaseHTTPRequestHandler):
	def do_POST(self):
		print(self.requestline)
		self.send_response(200)
		self.send_header('Content-type','text/html')
		self.end_headers()
		if self.path == "/Login-ExV2.php":
			form = cgi.FieldStorage(fp=self.rfile,headers=self.headers,environ={'REQUEST_METHOD': 'POST'})
			username = form.getvalue("username")
			userkey = form.getvalue("userkey")
			if username == "BDKR28" and userkey == "BDKR28":
				print("\n[+] Log: Fox ExV2 Has Been Authenticated By @BDKR28 ")
				self.wfile.write("True".encode())
			else:
				self.wfile.write("The login is invalid.".encode())				
		return
def SetupHost():
	try:
		datafile = open(hostfile, "a")
		datafile.write("\n\n"+serverip+" youfox.co \n")
		datafile.close()
		print("[+] Log: Initial Setup Completed ")
	except:
		print("[+] Error: Please Run Again With Administrator")
		sys.exit(0)
def CheckHost():
	try:
		if os.path.isfile(hostfile):
			datafile = open(hostfile, "rt").read()
			if "127.69.69.69" in datafile:
				print("[+] Log: Initial Setup Completed")
			else:
				SetupHost()
		else:
			SetupHost()
	except:
		print("[+] Error: Please Run Again With Administrator")
		sys.exit(0)

def SetupTrustCA():
	try:
		datafile = open(cafile, 'a')
		datafile.write("\n"+CA_CERT+"\n")
		datafile.close()
		print("[+] Log: Bypass System Setup Complete")
	except:
		print("[+] Error: Please Run Again With Administrator")
		sys.exit(0)
def CheckCAFile():
	try:
		datafile = open(cafile, "rt").read()
		if "@BDKR28" in datafile:
			print("[+] Log: Bypass System Setup Complete")
		else:
			SetupTrustCA()
	except:
		print("[+] Error: Unknown Error Contact @xploitednoob")
		sys.exit(0)

if __name__ == "__main__":
	try:
		print(banner)
		CheckHost()
		CheckCAFile()
		print("[+] Log: Bypass Server Access Log---> \n")
		key1 = open(certpath,"wt").write(CA_CERT)
		key2 = open(keypath,"wt").write(CA_KEY)
		server = HTTPServer((serverip, 443), myHandler)
		server.socket = ssl.wrap_socket(server.socket, certfile=certpath,keyfile=keypath, server_side=True)
		server.serve_forever()
	except KeyboardInterrupt:
		sys.exit(0)